!function(t){function i(r){if(e[r])return e[r].exports;var s=e[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){(function(t){var i={_name:"Data Driven Drawings"};t.DDD=Object.assign(i,e(1),e(7),e(9),e(10),e(11),e(12),e(13))}).call(i,function(){return this}())},function(t,i,e){function r(t,i,e){var r=Math.floor(Math.random()*(i-t))+t;return e&&(r=Math.random()*(i-t)+t),r}function s(t,i){return t/100*i}function o(t,i){return t/i*100}function n(t,i){return t>0&&0===(t&t-1)&&i>0&&0===(i&i-1)}function a(){this.reset()}var h={PI:Math.PI,TWO_PI:2*Math.PI,QUARTER_PI:Math.PI/4,toRad:Math.PI/180,random:r,Transform:a,sizeFromPercentage:s,getPercent:o,isPowerOfTwo:n,Point:e(2),Rectangle:e(3),Matrix:e(4),TextureUvs:e(5),Vector:e(6)};t.exports=h,a.prototype.reset=function(){this.m=[1,0,0,1,0,0]},a.prototype.multiply=function(t){var i=this.m[0]*t.m[0]+this.m[2]*t.m[1],e=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],s=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],n=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=i,this.m[1]=e,this.m[2]=r,this.m[3]=s,this.m[4]=o,this.m[5]=n},a.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=this.m[3]*t,e=-this.m[1]*t,r=-this.m[2]*t,s=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),n=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=i,this.m[1]=e,this.m[2]=r,this.m[3]=s,this.m[4]=o,this.m[5]=n},a.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),r=this.m[0]*i+this.m[2]*e,s=this.m[1]*i+this.m[3]*e,o=this.m[0]*-e+this.m[2]*i,n=this.m[1]*-e+this.m[3]*i;this.m[0]=r,this.m[1]=s,this.m[2]=o,this.m[3]=n},a.prototype.translate=function(t,i){this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i},a.prototype.translateAndRotate=function(t,i,e){var r=Math.cos(e),s=Math.sin(e),o=this.m[0]*r+this.m[2]*s,n=this.m[1]*r+this.m[3]*s,a=this.m[0]*-s+this.m[2]*r,h=this.m[1]*-s+this.m[3]*r;this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this.m[0]=o,this.m[1]=n,this.m[2]=a,this.m[3]=h},a.prototype.scale=function(t,i){this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i},a.prototype.transformPoint=function(t,i){var e=t,r=i;return t=e*this.m[0]+r*this.m[2]+this.m[4],i=e*this.m[1]+r*this.m[3]+this.m[5],[t,i]}},function(t,i){var e=function(t,i){this.x=t||0,this.y=i||0};t.exports=e,e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copy=function(t){this.set(t.x,t.y)},e.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},e.prototype.set=function(t,i){this.x=t||0,this.y=i||0!==i?this.x:0}},function(t,i){var e=function(t,i,e,r){this.x=t||0,this.y=i||0,this.width=e||0,this.height=r||0};t.exports=e},function(t,i,e){function r(t,i,e,r,s,o){this.a=t||1,this.b=i||0,this.c=e||0,this.d=r||1,this.tx=s||0,this.ty=o||0}var s=e(2);r.prototype.constructor=r,t.exports=r,r.prototype.toArray=function(t,i){this.array||(this.array=new Float32Array(9));var e=i||this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},r.prototype.apply=function(t,i){i=i||new s;var e=t.x,r=t.y;return i.x=this.a*e+this.c*r+this.tx,i.y=this.b*e+this.d*r+this.ty,i},r.prototype.applyInverse=function(t,i){i=i||new s;var e=1/(this.a*this.d+this.c*-this.b),r=t.x,o=t.y;return i.x=this.d*e*r+-this.c*e*o+(this.ty*this.c-this.tx*this.d)*e,i.y=this.a*e*o+-this.b*e*r+(-this.ty*this.a+this.tx*this.b)*e,i},r.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},r.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},r.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),r=this.a,s=this.c,o=this.tx;return this.a=r*i-this.b*e,this.b=r*e+this.b*i,this.c=s*i-this.d*e,this.d=s*e+this.d*i,this.tx=o*i-this.ty*e,this.ty=o*e+this.ty*i,this},r.prototype.append=function(t){var i=this.a,e=this.b,r=this.c,s=this.d;return this.a=t.a*i+t.b*r,this.b=t.a*e+t.b*s,this.c=t.c*i+t.d*r,this.d=t.c*e+t.d*s,this.tx=t.tx*i+t.ty*r+this.tx,this.ty=t.tx*e+t.ty*s+this.ty,this},r.prototype.setTransform=function(t,i,e,r,s,o,n){var a=Math.sin(n),h=Math.cos(n),c=h*s,u=a*s,d=-a*o,p=h*o;return this.a=c+d,this.b=u+p,this.c=c+d,this.d=u+p,this.tx=t+(e*c+r*d),this.ty=i+(e*u+r*p),this},r.prototype.prepend=function(t){var i=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this},r.prototype.invert=function(){var t=this.a,i=this.b,e=this.c,r=this.d,s=this.tx,o=t*r-i*e;return this.a=r/o,this.b=-i/o,this.c=-e/o,this.d=t/o,this.tx=(e*this.ty-r*s)/o,this.ty=-(t*this.ty-i*s)/o,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}},function(t,i){var e=function(t,i){var e=i.width,r=i.height;this.x0=t.x/e,this.y0=t.y/r,this.x1=(t.x+t.width)/e,this.y1=t.y/r,this.x2=(t.x+t.width)/e,this.y2=(t.y+t.height)/r,this.x3=t.x/e,this.y3=(t.y+t.height)/r};t.exports=e},function(t,i){var e=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0};t.exports=e,e.prototype.set=function(t,i,e){return this.x=t,this.y=i,this.z=e,this},e.prototype.setX=function(t){return this.x=t,this},e.prototype.setY=function(t){return this.y=t,this},e.prototype.setZ=function(t){return this.z=t,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},e.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},e.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},e.prototype.multiplyScalar=function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},e.prototype.multiplyVectors=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},e.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},e.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},e.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.setLength=function(t){return this.multiplyScalar(t/this.length())},e.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.prototype.normalize=function(){return this.divideScalar(this.length())},e.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y,r=this.z-t.z;return i*i+e*e+r*r},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},function(t,i,e){function r(t,i,e,r,s){var o=document.createElement("ul"),n="";o.id="years",o.style.zIndex=99999;for(var a=t;i>=a;a++){var h=document.createElement("li"),c=document.createTextNode(a);a===e&&(h.className="current",n=h),h.appendChild(c),o.appendChild(h),h.addEventListener("click",r,!1)}s(o,n)}function s(t,i,e){e=e||"current",t&&t.classList.remove(e),i.classList.add(e)}function o(t){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r=0;r<t.length;){var s,o,n=255&t.charCodeAt(r++),a=255&t.charCodeAt(r++),h=255&t.charCodeAt(r++),c=n>>2,u=(3&n)<<4|a>>4;isNaN(a)?s=o=64:(s=(15&a)<<2|h>>6,o=isNaN(h)?64:63&h),e+=i.charAt(c)+i.charAt(u)+i.charAt(s)+i.charAt(o)}return e}var n={yearsMenu:r,resetCurrent:s,base64:o,canvas:e(8)};t.exports=n},function(t,i){function e(t,i){var e=document.createElement("canvas"),r=e.getContext("2d");if(i=i||{},e.width=i.w||window.innerWidth,e.height=i.h||window.innerHeight,e.style.position=i.position||"absolute",e.style.top=i.top||0,e.style.left=i.left||0,e.style.zIndex=i.zi||9,i.css)for(var s in i.css)e.style[s]=i.css[s];return r.font=i.font||"12px Inconsolata",t&&t.appendChild(e),{container:t,canvas:e,w:e.width,h:e.height,ctx:r,center:{x:e.width/2,y:e.height/2}}}t.exports=e},function(t,i,e){function r(t){var i=t.width||window.innerWidth,e=t.height||window.innerHeight,r=t.zoom||11;t.center?this.center={lon:t.center.lon,lat:t.center.lat}:this.center={},this.hasCenter=null,this.updateSize(i,e,r)}var s=e(1);r.prototype.updateSize=function(t,i,e){this.stageWidth=t,this.stageCenterY=i/2,this.zoom=e||this.zoom,this.zoomX=this.stageWidth*this.zoom,this.zoomY=this.stageCenterY*this.zoom,this.zoomRad=this.zoomX/360,this.newCenter(this.center.lon,this.center.lat)},r.prototype.newCenter=function(t,i){this.hasCenter=!1,this.convertCoordinates(t,i),this.hasCenter=!0},r.prototype.convertCoordinates=function(t,i){var e=+i*s.toRad,r=Math.log(Math.tan(s.QUARTER_PI+e/2)),o=(+t+180)*this.zoomRad,n=this.zoomY-this.zoomX*r/s.TWO_PI;return this.hasCenter?(o-=this.center.x,n-=this.center.y):(this.center.x=o,this.center.y=n),{x:o,y:n}},t.exports={Map:r}},function(t,i){function e(t){var i=new o;return i.json(t)}function r(t){var i=new o;return i.req.overrideMimeType("text/plain; charset=x-user-defined"),i.getD(t).then(function(t){return void 0!==t.ret?t:t.data})["catch"](function(t){console.error(t)})}function s(t){var i=new o;return i.req.responseType="arraybuffer",i.getD(t).then(function(t){return t})["catch"](function(t){console.error("Error fetching audio file",t)})}function o(){this.req=new XMLHttpRequest}o.prototype.abort=function(){this.req.abort()},o.prototype.json=function(t){return this.req.overrideMimeType("application/json"),this.getD(t).then(function(t){return void 0!==t.ret?(t.data=JSON.parse(t.data),t):JSON.parse(t.data)})["catch"](function(t){console.error("Error in data request, reason:",t)})},o.prototype.getD=function(t){function i(){p.style.opacity=1,u.style.zIndex=9,s=p.querySelector(".loading-msg"),s||(s=document.createElement("p"),s.className="loading-msg",s.innerText=h,p.appendChild(s))}function e(t){if(t.lengthComputable){n||(o=p.querySelector(".progress"),o||(o=document.createElement("progress"),o.className="progress",o.style.zIndex=0,o.max=100,o.value=0,p.insertBefore(o,s),n=!0));var i=t.loaded/t.total*100;o.value=i,s.innerText=Math.floor(i)+"%\n"+h}else a.onprogress=null}function r(){d||(p.style.display="none"),u.style.zIndex=0}if("object"==typeof t){if(!t.url)return void console.error("The request did not receive a url, instead got",t.url)}else"string"==typeof t&&t.length>0&&(t={url:t});var s,o,n=!1,a=this.req,h=t.loadingMsg||"Loading",c=t.container||document.body,u=c.querySelector(".loading");u||(u=document.createElement("div"),u.className="loading",c.appendChild(u));var d=!!t.loadingEle,p=d?t.loadingEle:null;if(!p){var f=c.querySelector(".loading-ele");p=document.createElement("div"),p.className="loadingEle",f?u.insertBefore(f,p):u.appendChild(p)}return new Promise(function(s,o){a.open("GET",t.url,!0),a.onloadstart=i,a.onprogress=e,a.onloadend=r,a.onload=function(){200===a.status?s({data:a.response,ret:t.ret}):o(a.statusText)},a.onerror=function(){o("Network Error")},a.send(null)})},t.exports={DataRequest:o,json:e,image:r,audio:s}},function(t,i){function e(t,i,e){return"0x"+((1<<24)+(t<<16)+(i<<8)+e).toString(16).slice(1)}function r(t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(i,function(t,i,e,r){return i+i+e+e+r+r});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function s(t){var i=255/t,e=1/i;return e}function o(t,i){return"rgba("+t.r+","+t.g+","+t.b+","+i+")"}var n={hexToRgb:r,rgbToHex:e,convertAlpha:s,getRGBA:o};t.exports=n},function(t,i,e){var r=e(10).audio,s=function(t,i){function e(t,i){function e(t){if(!t)return void console.error("Error decoding audio file:",i);var e=this.ctx.createBufferSource();e.buffer=t,a[i]=e,s()}function r(t){console.error("decodeAudioData error",t)}var o=this;this.ctx.decodeAudioData(t,e.bind(o),r)}function s(){n++,n===o&&i(a)}if(!t||"[object Object]"!==Object.prototype.toString.call(t))return console.error("The first parameter needs to be an Object.","Example:","{audio1: 'audio1.mp3', audio2: 'audio2.mp3'}");window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=Object.keys(t).length,n=0,a={};this.ctx=new AudioContext;for(var h in t)r(t[h],e.bind(this),h,document.body,"Loading Audio")};s.prototype.source=function(t){var t=this.ctx.createBufferSource();return t.buffer=buffer,t.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),t},t.exports={Audio:s}},function(t,i,e){var r={Stage:e(14),Webgl:e(15)};t.exports=r},function(t,i,e){var r=e(1),s=function(t,i,e,s,o){this.children=[],this.texture={},this.data=t,this.renderer=i,this.loadImg(t.url),this.worldAlpha=1,this.worldTransform=new r.Matrix,this._maxSizeCache=e,this.batchSize=e||15e3,this.maxSize=o||15e3,this.setBatchSize(e,o),s=s||{},this.properties=[!1,!0,!1,!1,!1],this.buffers=null,this._bufferToUpdate=0,s&&(this.properties[0]="scale"in s?!!s.scale:this.properties[0],this.properties[1]="position"in s?!!s.position:this.properties[1],this.properties[2]="rotation"in s?!!s.rotation:this.properties[2],this.properties[3]="uvs"in s?!!s.uvs:this.properties[3],this.properties[4]="alpha"in s?!!s.alpha:this.properties[4])};t.exports=s,s.prototype.setBatchSize=function(t,i){var e=16384;t>e&&(t=e),t>i&&(t=i),this.batchSize=t},s.prototype.renderWebGL=function(t){t.currentRenderer.render(this)},s.prototype.bindTexture=function(){var t=this.renderer.gl,i=this.texture;return i.glTexture||(i.glTexture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,i.glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),i.mipmap&&i.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),i.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),!0},s.prototype.loadImg=function(t){this.img=new Image,this.img.onload=this.imgLoaded.bind(this),this.img.src=t},s.prototype.imgLoaded=function(){for(var t=this.img.naturalWidth,i=this.img.naturalHeight,e={loaded:!0,isPowerOfTwo:r.isPowerOfTwo(t,i)},s=[],o=0;o<this.data.frames.length;o++){var n=this.data.frames[o],a=new r.Rectangle(n.x,n.y,n.w,n.h);s.push({width:n.w,height:n.h,uvs:new r.TextureUvs(a,{width:t,height:i})})}this.renderer.frames=s,this.texture=e,this.bindTexture(),this.data.cb&&this.data.cb()},s.prototype.particle=function(t){return t=t||{},t.anchor=t.anchor||new DDD.Point(.5),t.scale=t.scale||new DDD.Point(1,1),t.alpha=t.alpha||1,t.rotation=t.rotation||0,t.x=t.x||0,t.y=t.y||0,t.frame=t.frame||0,this.children.push(t),this.children.length>this.batchSize&&this.setBatchSize(this.children.length,this._maxSizeCache),t}},function(t,i,e){var r=e(16),s=e(17),o=function(t,i,e){this.container=t,i=i||{},this.width=i.width||window.innerWidth,this.height=i.height||window.innerHeight,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",t.appendChild(this.canvas),e=e||{};var o={alpha:e.alpha||!0,antialias:e.antialias||!1,premultipliedAlpha:e.premiltipliedAlpha||!0,stencil:e.stencil||!1,preserveDrawingBuffer:e.preserveDrawingBuffer||!1},n=this.canvas.getContext("webgl",o)||this.canvas.getContext("experimental-webgl",o);this.gl=n,n.disable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.enable(n.BLEND),this.renderTarget=new r(n,this.width,this.height),this.currentRenderer=new s(this),this.resize(this.width,this.height)};t.exports=o,o.prototype.setShader=function(){for(var t=this.gl,i=[!0,!0,!0,!0,!0],e=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=[],s=0;e>s;s++)r[s]=!1;for(var o=0;e>o;o++)r[o]=i[o],r[o]?t.enableVertexAttribArray(o):t.disableVertexAttribArray(o)},o.prototype.render=function(t){t.renderWebGL(this)},o.prototype.resize=function(t,i){this.width=this.canvas.width=t,this.height=this.canvas.height=i,this.renderTarget.resize(t,i),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))}},function(t,i,e){var r=e(1),s=function(t,i,e){this.gl=t,this.frameBuffer=null,this.size=new r.Rectangle(0,0,1,1),this.projectionMatrix=new r.Matrix,this.transform=null,this.stencilBuffer=null,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.resize(i,e),this.activate()};t.exports=s,s.prototype.clear=function(t){var i=this.gl;t&&i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)},s.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);var i=this.size;this.calculateProjection(i),t.viewport(0,0,i.width,i.height)},s.prototype.calculateProjection=function(t){var i=this.projectionMatrix;i.identity(),i.a=1/t.width*2,i.d=-1/t.height*2,i.tx=-1-t.x*i.a,i.ty=1-t.y*i.d},s.prototype.resize=function(t,i){if(t=0|t,i=0|i,this.size.width!==t||this.size.height!==i){this.size.width=t,this.size.height=i;var e=this.size;this.calculateProjection(e)}}},function(t,i,e){var r=e(1),s=e(18),o=e(19),n=function(t){var i=98304;this.indices=new Uint16Array(i);for(var e=0,s=0;i>e;e+=6,s+=4)this.indices[e+0]=s+0,this.indices[e+1]=s+1,this.indices[e+2]=s+2,this.indices[e+3]=s+0,this.indices[e+4]=s+2,this.indices[e+5]=s+3;this.shader=new o(t.gl),this.indexBuffer=null,this.properties=null,this.tempMatrix=new r.Matrix,this.renderer=t,this.start()};t.exports=n,n.prototype.start=function(){var t=this.renderer.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.shader.program),this.renderer.setShader(),this.onContextChange()},n.prototype.render=function(t){var i=t.texture,e=t.children,r=e.length,s=t.maxSize,o=t.batchSize;if(0!==r){r>s&&(r=s),t.buffers||(t.buffers=this.generateBuffers(t));var n=this.renderer.gl,a=t.worldTransform.copy(this.tempMatrix);a.prepend(this.renderer.renderTarget.projectionMatrix),n.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,a.toArray(!0)),n.uniform1f(this.shader.uniforms.uAlpha._location,t.worldAlpha),n.bindTexture(n.TEXTURE_2D,i.glTexture);for(var h=0,c=0;r>h;h+=o,c+=1){var u=r-h;u>o&&(u=o);var d=t.buffers[c];d.uploadDynamic(e,h,u),t._bufferToUpdate===c&&(d.uploadStatic(e,h,u),t._bufferToUpdate=c+1),d.bind(this.shader),n.drawElements(n.TRIANGLES,6*u,n.UNSIGNED_SHORT,0)}}},n.prototype.generateBuffers=function(t){var i,e=this.renderer.gl,r=[],o=t.maxSize,n=t.batchSize,a=t.properties;for(i=0;o>i;i+=n)r.push(new s(e,this.properties,a,n));return r},n.prototype.uploadVertices=function(t,i,e,r,s,o){for(var n=0;e>n;n++){var a=t[i+n],h=a.frame,c=this.renderer.frames[h],u=a.scale.x,d=a.scale.y,p=c.width*(1-a.anchor.x),f=c.width*-a.anchor.x,l=c.height*(1-a.anchor.y),m=c.height*-a.anchor.y;r[o]=f*u,r[o+1]=m*d,r[o+s]=p*u,r[o+s+1]=m*d,r[o+2*s]=p*u,r[o+2*s+1]=l*d,r[o+3*s]=f*u,r[o+3*s+1]=l*d,o+=4*s}},n.prototype.uploadPosition=function(t,i,e,r,s,o){for(var n=0;e>n;n++){var a=t[i+n].x,h=t[i+n].y;r[o]=a,r[o+1]=h,r[o+s]=a,r[o+s+1]=h,r[o+2*s]=a,r[o+2*s+1]=h,r[o+3*s]=a,r[o+3*s+1]=h,o+=4*s}},n.prototype.uploadRotation=function(t,i,e,r,s,o){for(var n=0;e>n;n++){var a=t[i+n].rotation;r[o]=a,r[o+s]=a,r[o+2*s]=a,r[o+3*s]=a,o+=4*s}},n.prototype.uploadUvs=function(t,i,e,r,s,o){for(var n=0;e>n;n++){var a=t[i+n],h=a.frame,c=this.renderer.frames[h].uvs;r[o]=c.x0,r[o+1]=c.y0,r[o+s]=c.x1,r[o+s+1]=c.y1,r[o+2*s]=c.x2,r[o+2*s+1]=c.y2,r[o+3*s]=c.x3,r[o+3*s+1]=c.y3,o+=4*s}},n.prototype.uploadAlpha=function(t,i,e,r,s,o){for(var n=0;e>n;n++){var a=t[i+n].alpha;r[o]=a,r[o+s]=a,r[o+2*s]=a,r[o+3*s]=a,o+=4*s}},n.prototype.onContextChange=function(){var t=this.renderer.gl;this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices.bind(this),offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs.bind(this),offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]}},function(t,i){function e(t,i,e,r){this.gl=t,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var s=0;s<i.length;s++){var o=i[s];e[s]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}e.prototype.constructor=e,t.exports=e,e.prototype.initBuffers=function(){var t,i,e=this.gl,r=0;for(this.dynamicStride=0,t=0;t<this.dynamicProperties.length;t++)i=this.dynamicProperties[t],i.offset=r,r+=i.size,this.dynamicStride+=i.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.dynamicBuffer),e.bufferData(e.ARRAY_BUFFER,this.dynamicData,e.DYNAMIC_DRAW);var s=0;for(this.staticStride=0,t=0;t<this.staticProperties.length;t++)i=this.staticProperties[t],i.offset=s,s+=i.size,this.staticStride+=i.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.staticBuffer),e.bufferData(e.ARRAY_BUFFER,this.staticData,e.DYNAMIC_DRAW)},e.prototype.uploadDynamic=function(t,i,e){for(var r=this.gl,s=0;s<this.dynamicProperties.length;s++){var o=this.dynamicProperties[s];o.uploadFunction(t,i,e,this.dynamicData,this.dynamicStride,o.offset)}r.bindBuffer(r.ARRAY_BUFFER,this.dynamicBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.dynamicData)},e.prototype.uploadStatic=function(t,i,e){for(var r=this.gl,s=0;s<this.staticProperties.length;s++){var o=this.staticProperties[s];o.uploadFunction(t,i,e,this.staticData,this.staticStride,o.offset)}r.bindBuffer(r.ARRAY_BUFFER,this.staticBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.staticData)},e.prototype.bind=function(){var t,i,e=this.gl;for(e.bindBuffer(e.ARRAY_BUFFER,this.dynamicBuffer),t=0;t<this.dynamicProperties.length;t++)i=this.dynamicProperties[t],e.vertexAttribPointer(i.attribute,i.size,e.FLOAT,!1,4*this.dynamicStride,4*i.offset);for(e.bindBuffer(e.ARRAY_BUFFER,this.staticBuffer),t=0;t<this.staticProperties.length;t++)i=this.staticProperties[t],e.vertexAttribPointer(i.attribute,i.size,e.FLOAT,!1,4*this.staticStride,4*i.offset)}},function(t,i){var e=function(t){this.gl=t,this.uniforms={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])},uAlpha:{type:"1f",value:1}},this.attributes={aVertexPosition:0,aTextureCoord:0,aColor:0,aPositionCoord:0,aRotation:0},this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","vec2 v = aVertexPosition;","v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","v = v + aPositionCoord;","gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"].join(""),this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","if (color.a == 0.0) discard;","gl_FragColor = color;","}"].join("");var i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,this.vertexSrc),t.compileShader(i);var e=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,this.fragmentSrc),t.compileShader(e);var r=t.createProgram();t.attachShader(r,i),t.attachShader(r,e),t.linkProgram(r),t.deleteShader(i),t.deleteShader(e),this.program=r,this.gl.useProgram(r),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))};t.exports=e,e.prototype.cacheUniformLocations=function(t){for(var i=0;i<t.length;++i)this.uniforms[t[i]]._location=this.gl.getUniformLocation(this.program,t[i])},e.prototype.cacheAttributeLocations=function(t){for(var i=0;i<t.length;++i)this.attributes[t[i]]=this.gl.getAttribLocation(this.program,t[i])}}]);