!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();e.Notations=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.container||document.body;if(e.url&&DDD.json({url:e.url,container:n}).then(e.cb).catch(function(t){console.error(t)}),e.img){this.imgCallback=e.img.cb,DDD.image({url:e.img.src,container:n,loadingMsg:e.img.msg}).then(this.prepareImageData.bind(this)),this.imgW=e.img.width,this.imgH=e.img.height,this.fps=e.fps;var i=this.imgW-e.img.offLeft-e.img.offRight,o=this.imgH-e.img.offTop-e.img.offBottom;this.percent={h:DDD.getPercent(o,this.imgH),w:DDD.getPercent(i,this.imgW),top:DDD.getPercent(e.img.offTop,this.imgH),bottom:DDD.getPercent(e.img.offBottom,this.imgH),left:DDD.getPercent(e.img.offLeft,this.imgW),right:DDD.getPercent(e.img.offRight,this.imgW)}}this.stage=DDD.canvas(n,{w:n.offsetWidth}),this.canvas=this.stage.canvas,this.ctx=this.stage.ctx}return i(t,[{key:"prepareImageData",value:function(t){this.img=new Image,this.img.onload=this.imgCallback,this.img.src="data:image/jpeg;base64,"+DDD.base64(t)}}]),t}(),e.notationsVideo=function(t,e){return t.onloadedmetadata=function(){return e(),!1},t.onerror=function(e){var n=document.createElement("div");return n.innerHTML=t.innerHTML,t.parentNode.replaceChild(n,t),!1},t}},,,,function(t,e,n){"use strict";var i=n(0),o=document.getElementById("bottom"),s=document.getElementById("left"),a=document.getElementById("label-box"),r=document.getElementById("pol"),c=document.getElementById("eng"),l=(0,i.notationsVideo)(document.getElementById("video"),function(){X(),t=document.getElementById("video-container"),e=document.createElement("div"),e.className="loading",t.appendChild(e),DDD.json({url:"/data/notations/tango.json",container:document.getElementById("ddd-container"),loadingEle:e,loadingMsg:"Loading metadata"}).then(function(n){t.removeChild(e),v=n,x=n.sections.length,P++,u=new i.Notations({container:o}),D=new i.Notations({container:s}),d=DDD.canvas(o,{h:u.canvas.height,zi:1}),T.all(),d.ctx.fillRect(0,0,T.bottomW,T.bottomH),f.style.opacity=1,function(){for(var t=0;t<z.total;){var e=new Image;e.dataset.key=t,e.onload=function(){var t=this.dataset.key,e=z.timelineW;z.loaded++;var n=z.loaded/z.total*100;p.value=n,h.innerText=Math.floor(n)+"%\n"+m,k(z.frames[t],t*e,u.offY,e),X()},e.src="/img/assets/notations/tango/tango"+t+".jpg",z.frames[t]=e,t++}}()}).catch(function(t){console.error(t)}),l.onplay=function(){return g=requestAnimationFrame(F),!1},l.onpause=function(){return window.cancelAnimationFrame(g),!1},l.onseeking=function(){return E(),!1};var t,e}),m="Please be patient, loading large images",h=document.createElement("p");h.className="loading-msg",h.innerText=m;var f=document.createElement("div");f.className="loading",f.style.opacity=0;var g,u,d,D,p=document.createElement("progress");p.className="progress",p.style.zIndex=0,p.max=100,p.value=0,f.appendChild(p),f.appendChild(h),s.appendChild(f);var v={},b=!1,P=0,x=0,y=!1,H=0,W=0,w=0,z={total:16,loaded:0,totalW:15458,width:1e3,height:785,frames:{}},T={reset:function(){this.bottomW=window.innerWidth,this.topH=document.getElementById("header").offsetHeight,this.timelinePercent=DDD.getPercent(this.bottomW,z.totalW),this.bottomH=DDD.sizeFromPercentage(this.timelinePercent,z.height)+30|0,this.leftH=window.innerHeight-this.topH-this.bottomH,this.notationsPercent=DDD.getPercent(this.leftH,z.height)},resizeTimeline:function(t){t||this.reset(),this.timelineH=0|DDD.sizeFromPercentage(this.timelinePercent,z.height),u.canvas.width=d.canvas.width=this.bottomW,u.canvas.height=d.canvas.height=this.bottomH,o.style.height=this.bottomH+"px",this.bottomH>this.timelineH?u.offY=this.bottomH/2-this.timelineH/2:u.offY=0,u.offX=0|DDD.sizeFromPercentage(this.timelinePercent,v.initX),u.ctx.strokeStyle="red",z.timelineW=DDD.sizeFromPercentage(this.timelinePercent,1e3)},resizeNotations:function(t){t||this.reset(),this.leftW=s.offsetWidth,s.style.top=this.topH+"px",s.style.height=this.leftH+"px",D.resizeW=DDD.sizeFromPercentage(this.notationsPercent,z.totalW),D.canvas.height=this.leftH,D.canvas.width=this.leftW,D.offX=0|DDD.sizeFromPercentage(this.notationsPercent,v.initX),D.ctx.strokeStyle="red",a.style.left=D.offX+"px",z.notationsW=DDD.sizeFromPercentage(this.notationsPercent,1e3)},videoData:function(t){t||this.reset();var e=window.innerHeight-this.bottomH,n=v.endX-v.initX;l.style.maxHeight=e+"px",l.style.marginTop=e/2-l.offsetHeight/2+"px",this.videoTimelineW=l.duration/DDD.sizeFromPercentage(this.timelinePercent,n),this.videoNotationsW=l.duration/DDD.sizeFromPercentage(this.notationsPercent,n)},resizeData:function(){for(var t=v.sections.length,e=v.labels.length,n=0;n<t;n++){var i=v.sections[n].x,o=n===v.sections.length-1?v.endX-i:v.sections[n+1].x-i;v.sections[n].nX=0|DDD.sizeFromPercentage(this.notationsPercent,i),v.sections[n].nW=0|DDD.sizeFromPercentage(this.notationsPercent,o),v.sections[n].tX=0|DDD.sizeFromPercentage(this.timelinePercent,i),v.sections[n].tW=0|DDD.sizeFromPercentage(this.timelinePercent,o)}for(var s=0;s<e;s++){i=v.labels[s].x;var a=v.labels[s].y,r=(o=v.labels[s].w,v.labels[s].h);v.labels[s].nX=0|DDD.sizeFromPercentage(this.notationsPercent,i),v.labels[s].nY=this.topH+DDD.sizeFromPercentage(this.notationsPercent,a)|0,v.labels[s].nW=0|DDD.sizeFromPercentage(this.notationsPercent,o),v.labels[s].nH=0|DDD.sizeFromPercentage(this.notationsPercent,r)}},updateRepaint:function(){this.reset(),this.resizeTimeline(!0),this.resizeNotations(!0),this.videoData(!0),this.resizeData(),function(){d.ctx.fillRect(0,0,T.bottomW,T.bottomH);var t=0,e=z.timelineW;for(;t<z.total;)k(z.frames[t],t*e,u.offY,e),t++}(),E()},all:function(){this.reset(),this.resizeTimeline(!0),this.resizeNotations(!0),this.videoData(!0),this.resizeData()}};function X(){18===++P&&(b=!0,s.removeChild(f),E(),l.controls=!0,function(){function t(){return y=!1,!1}s.onmousedown=function(t){return b&&(H=t.clientX,y=!0),!1},s.onmouseup=t,o.onmouseup=t,s.onmousemove=function(t){if(y){var e=H-t.clientX;l.currentTime+=T.videoNotationsW*e,H=t.clientX}else{for(var n=t.clientX,i=t.clientY,o=v.labels.length,s=!1,m=0;m<o;m++){var h=v.labels[m].nX-w,f=h+v.labels[m].nW,g=v.labels[m].nY,u=g+v.labels[m].nH;if(n>=h&&n<f&&i>=g&&i<u){a.className=v.labels[m].class,a.style.top=g-T.topH-16+"px",r.innerText=v.labels[m].label,c.innerText=v.labels[m].eng,s=!0,a.style.opacity=1;break}}s||(a.style.opacity=0)}return!1},s.onmouseleave=function(){y=!1},o.onmousedown=function(t){if(b){var e=t.clientX-W;l.currentTime+=T.videoTimelineW*e,y=!0}return!1},o.onmousemove=function(t){if(y){var e=t.clientX-W;l.currentTime+=T.videoTimelineW*e}return!1}}())}function F(){E(),g=requestAnimationFrame(F)}function E(){for(var t,e,n=l.currentTime,i=0;i<x;i++)if(i<x-1){if(n>=v.sections[i].start&&n<v.sections[i+1].start){t=v.sections[i],e=v.sections[i+1];break}}else t=v.sections[i],e={start:l.duration,x:v.endX};var o=e.start-t.start,s=n-t.start,a=s*(t.nW/o),r=s*(t.tW/o);W=r+t.tX,w=a+(t.nX-D.offX),u.ctx.clearRect(0,0,T.bottomW,T.bottomH),u.ctx.beginPath(),u.ctx.moveTo(W,0),u.ctx.lineTo(W,T.bottomH),u.ctx.stroke(),function(t){D.ctx.clearRect(0,0,T.leftW,T.leftH);var e,n=z.notationsW,i=z.total;for(e=0;e<i;e++){var o=e*n,s=o-t,a=s+n;if(!(a<=0)){if(s>T.leftW)break;I(z.frames[e],s,n)}}}(w),D.ctx.beginPath(),D.ctx.moveTo(D.offX,0),D.ctx.lineTo(D.offX,T.leftH),D.ctx.stroke()}function I(t,e,n){D.ctx.drawImage(t,0,0,z.width,z.height,e,0,n,T.leftH)}function k(t,e,n,i){d.ctx.drawImage(t,0,0,z.width,z.height,0|e,0|n,i,T.timelineH)}window.onresize=T.updateRepaint.bind(T)}]);