!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=33)}({0:function(t,e,i){"use strict";i.d(e,"e",(function(){return h})),i.d(e,"g",(function(){return c})),i.d(e,"c",(function(){return l})),i.d(e,"r",(function(){return m})),i.d(e,"t",(function(){return f})),i.d(e,"n",(function(){return g})),i.d(e,"h",(function(){return o})),i.d(e,"i",(function(){return a})),i.d(e,"l",(function(){return p})),i.d(e,"u",(function(){return v})),i.d(e,"s",(function(){return b})),i.d(e,"k",(function(){return x})),i.d(e,"q",(function(){return y})),i.d(e,"p",(function(){return T})),i.d(e,"b",(function(){return w})),i.d(e,"d",(function(){return E})),i.d(e,"o",(function(){return z})),i.d(e,"m",(function(){return P})),i.d(e,"a",(function(){return A})),i.d(e,"f",(function(){return R})),i.d(e,"j",(function(){return H}));class s{constructor(t,e){this.x=t||0,this.y=e||0}clone(){return new s(this.x,this.y)}copy(t){this.set(t.x,t.y)}equals(t){return t.x===this.x&&t.y===this.y}set(t,e){this.x=t||0,this.y=e||0!==e?this.x:0}}class n{constructor(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0}}class r{constructor(t,e,i,s,n,r){this.a=t||1,this.b=e||0,this.c=i||0,this.d=s||1,this.tx=n||0,this.ty=r||0}toArray(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new s;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new s;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*i*n+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,r=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this}append(t){var e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,s,n,r,a){var o=Math.sin(a),h=Math.cos(a),c=h*n,l=o*n,u=-o*r,d=h*r;return this.a=c+u,this.b=l+d,this.c=c+u,this.d=l+d,this.tx=t+(i*c+s*u),this.ty=e+(i*l+s*d),this}prepend(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}invert(){var t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,r=t*s-e*i;return this.a=s/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-s*n)/r,this.ty=-(t*this.ty-e*n)/r,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){var t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copy(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}}class a{constructor(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}setLength(t){return this.multiplyScalar(t/this.length())}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}normalize(){return this.divideScalar(this.length())}distanceToSquared(t){var e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}limit(t){return this.lengthSq()>t*t&&(this.normalize(),this.mult(t)),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}}class o{constructor(){this.reset()}reset(){this.m=[1,0,0,1,0,0]}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],n=this.m[1]*t.m[2]+this.m[3]*t.m[3],r=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=s,this.m[3]=n,this.m[4]=r,this.m[5]=a}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,s=-this.m[2]*t,n=this.m[0]*t,r=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=s,this.m[3]=n,this.m[4]=r,this.m[5]=a}rotate(t){var e=Math.cos(t),i=Math.sin(t),s=this.m[0]*e+this.m[2]*i,n=this.m[1]*e+this.m[3]*i,r=this.m[0]*-i+this.m[2]*e,a=this.m[1]*-i+this.m[3]*e;this.m[0]=s,this.m[1]=n,this.m[2]=r,this.m[3]=a}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}translateAndRotate(t,e,i){var s=Math.cos(i),n=Math.sin(i),r=this.m[0]*s+this.m[2]*n,a=this.m[1]*s+this.m[3]*n,o=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this.m[0]=r,this.m[1]=a,this.m[2]=o,this.m[3]=h}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}transformPoint(t,e){var i=t,s=e;return[t=i*this.m[0]+s*this.m[2]+this.m[4],e=i*this.m[1]+s*this.m[3]+this.m[5]]}}const h=Math.PI,c=2*h,l=h/2,u=h/4,d=h/180;function m(t,e,i){let s=Math.floor(Math.random()*(e-t))+t;return i&&(s=Math.random()*(e-t)+t),s}function f(t,e){return t/100*e}function g(t,e){return t/e*100}function p(t,e){const i=document.createElement("canvas"),s=i.getContext("2d");if(e=e||{},i.width=e.w||window.innerWidth,i.height=e.h||window.innerHeight,i.style.position=e.position||"absolute",i.style.top=e.top||0,i.style.left=e.left||0,i.style.zIndex=e.zi||9,e.css)for(var n in e.css)i.style[n]=e.css[n];return s.font=e.font||"12px Inconsolata",t&&t.appendChild(i),{container:t,canvas:i,w:i.width,h:i.height,ctx:s,center:{x:i.width/2,y:i.height/2}}}function v(t,e,i,s,n){var r=document.createElement("ul"),a="";r.id="years",r.style.zIndex=99999;for(var o=t;o<=e;o++){var h=document.createElement("li"),c=document.createTextNode(o);o===i&&(h.className="current",a=h),h.appendChild(c),r.appendChild(h),h.addEventListener("click",s,!1)}n(r,a)}function b(t,e,i){i=i||"current",t&&t.classList.remove(i),e.classList.add(i)}function x(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",s=0;s<t.length;){var n,r,a=255&t.charCodeAt(s++),o=255&t.charCodeAt(s++),h=255&t.charCodeAt(s++),c=a>>2,l=(3&a)<<4|o>>4;isNaN(o)?n=r=64:(n=(15&o)<<2|h>>6,r=isNaN(h)?64:63&h),i+=e.charAt(c)+e.charAt(l)+e.charAt(n)+e.charAt(r)}return i}function y(t){return(new w).json(t)}function T(t){var e=new w;return e.req.overrideMimeType("text/plain; charset=x-user-defined"),e.getD(t).then((function(t){return void 0!==t.ret?t:t.data})).catch((function(t){console.error(t)}))}class w{constructor(){this.req=new XMLHttpRequest}abort(){this.req.abort()}json(t){return this.req.overrideMimeType("application/json"),this.getD(t).then((function(t){return void 0!==t.ret?(t.data=JSON.parse(t.data),t):JSON.parse(t.data)})).catch((function(t){console.error("Error in data request, reason:",t)}))}getD(t){if("object"==typeof t){if(!t.url)return void console.error("The request did not receive a url, instead got",t.url)}else"string"==typeof t&&t.length>0&&(t={url:t});var e,i,s=!1,n=this.req,r=t.loadingMsg||"Loading",a=t.container||document.body,o=a.querySelector(".loading");o||((o=document.createElement("div")).className="loading",a.appendChild(o));var h=!!t.loadingEle,c=h?t.loadingEle:null;if(!c){var l=a.querySelector(".loading-ele");(c=document.createElement("div")).className="loadingEle",l?o.insertBefore(l,c):o.appendChild(c)}function u(){c.style.opacity=1,o.style.zIndex=9,(e=c.querySelector(".loading-msg"))||((e=document.createElement("p")).className="loading-msg",e.innerText=r,c.appendChild(e))}function d(t){if(t.lengthComputable){s||(i=c.querySelector(".progress"))||((i=document.createElement("progress")).className="progress",i.style.zIndex=0,i.max=100,i.value=0,c.insertBefore(i,e),s=!0);var a=t.loaded/t.total*100;i.value=a,e.innerText=Math.floor(a)+"%\n"+r}else n.onprogress=null}function m(){h||(c.style.display="none"),o.style.zIndex=0}return new Promise((function(e,i){n.open("GET",t.url,!0),n.onloadstart=u,n.onprogress=d,n.onloadend=m,n.onload=function(){200===n.status?e({data:n.response,ret:t.ret}):i(n.statusText)},n.onerror=function(){i("Network Error")},n.send(null)}))}}class E{constructor(t){var e=t.width||window.innerWidth,i=t.height||window.innerHeight,s=t.zoom||11;t.center?this.center={lon:t.center.lon,lat:t.center.lat}:this.center={},this.hasCenter=null,this.updateSize(e,i,s)}updateSize(t,e,i){this.stageWidth=t,this.stageCenterY=e/2,this.zoom=i||this.zoom,this.zoomX=this.stageWidth*this.zoom,this.zoomY=this.stageCenterY*this.zoom,this.zoomRad=this.zoomX/360,this.newCenter(this.center.lon,this.center.lat)}newCenter(t,e){this.hasCenter=!1,this.convertCoordinates(t,e),this.hasCenter=!0}convertCoordinates(t,e){var i=+e*d,s=Math.log(Math.tan(u+i/2)),n=(+t+180)*this.zoomRad,r=this.zoomY-this.zoomX*s/c;return this.hasCenter?(n-=this.center.x,r-=this.center.y):(this.center.x=n,this.center.y=r),{x:n,y:r}}}function z(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,s){return e+e+i+i+s+s}));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function P(t){return 1/(255/t)}class A{constructor(t,e){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return console.error("The first parameter needs to be an Object.","Example:","{audio1: 'audio1.mp3', audio2: 'audio2.mp3'}");window.AudioContext=window.AudioContext||window.webkitAudioContext;var i,s,n=Object.keys(t).length,r=0,a={};for(var o in this.ctx=new AudioContext,t)i=t[o],h.bind(this),document.body,s=void 0,(s=new w).req.responseType="arraybuffer",s.getD(i).then((function(t){return t})).catch((function(t){console.error("Error fetching audio file",t)}));function h(t,i){this.ctx.decodeAudioData(t,function(t){if(!t)return void console.error("Error decoding audio file:",i);var s=this.ctx.createBufferSource();s.buffer=t,a[i]=s,++r===n&&e(a)}.bind(this),(function(t){console.error("decodeAudioData error",t)}))}}source(t){return(t=this.ctx.createBufferSource()).buffer=buffer,t.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),t}}class R{constructor(t,e,i){this.children=[],this.texture={},this.data=t,this.renderer=e,this.loadImg(t.url),this.setBatchSize(i)}setBatchSize(t){t>16384&&(t=16384),t>15e3&&(t=15e3),this.batchSize=t}renderWebGL(t){t.currentRenderer.render(this)}bindTexture(){var t=this.renderer.gl,e=this.texture;return e.glTexture||(e.glTexture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,e.glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e.mipmap&&e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),!0}loadImg(t){this.img=new Image,this.img.onload=this.imgLoaded.bind(this),this.img.src=t}imgLoaded(){for(var t,e,i=this.img.naturalWidth,s=this.img.naturalHeight,n={loaded:!0,isPowerOfTwo:(t=i,e=s,t>0&&0==(t&t-1)&&e>0&&0==(e&e-1))},r=[],a=0;a<this.data.frames.length;a++){var o=this.data.frames[a];r.push({width:o.w,height:o.h,uvs:[o.x/i,o.y/s,(o.x+o.w)/i,(o.y+o.h)/s]})}this.renderer.frames=r,this.texture=n,this.bindTexture(),this.data.cb&&this.data.cb()}particle(t){return(t=t||{}).scale=t.scale||new s(1,1),t.alpha=t.alpha||1,t.rotation=t.rotation||0,t.x=t.x||0,t.y=t.y||0,t.frame=t.frame||0,this.children.push(t),this.children.length>this.batchSize&&this.setBatchSize(this.children.length),t}}class j{constructor(t,e,i){this.gl=t,this.size=new n(0,0,1,1),this.projectionMatrix=new r,this.resize(e,i)}resize(t,e){if(t|=0,e|=0,this.size.width!==t||this.size.height!==e){this.size.width=t,this.size.height=e;var i=this.projectionMatrix.identity();i.a=2/this.size.width,i.d=-2/this.size.height,i.tx=-1,i.ty=1}}}var O=i(1),S=i.n(O),_=i(2),C=i.n(_);class M{constructor(t){this.gl=t,this.uniforms={projectionMatrix:{}},this.attributes={};var e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,S.a),t.compileShader(e);var i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,C.a),t.compileShader(i);var s=t.createProgram();t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),t.deleteShader(e),t.deleteShader(i),this.program=s,t.useProgram(s),this.cacheUniformLocations(["projectionMatrix"]),this.cacheAttributeLocations(["aVertexPosition","aTextureCoord","aAlpha","aPositionCoord","aRotation"])}cacheUniformLocations(t){for(var e=0;e<t.length;++e)this.uniforms[t[e]]._location=this.gl.getUniformLocation(this.program,t[e])}cacheAttributeLocations(t){for(var e=0;e<t.length;++e)this.attributes[t[e]]=this.gl.getAttribLocation(this.program,t[e])}}class W{constructor(t,e){this.renderer=e,this.gl=t,this.start()}start(){var t=this.gl,e=new M(t);this.properties=[{attribute:e.attributes.aVertexPosition,size:2},{attribute:e.attributes.aPositionCoord,size:2},{attribute:e.attributes.aRotation,size:1},{attribute:e.attributes.aTextureCoord,size:2},{attribute:e.attributes.aAlpha,size:1}];for(var i=0;i<this.properties.length;i++)t.enableVertexAttribArray(i);var s=this.renderer.renderTarget.projectionMatrix;t.uniformMatrix3fv(e.uniforms.projectionMatrix._location,!1,s.toArray(!0))}render(t){t.texture;var e=t.children,i=e.length,s=t.maxSize;this.size=t.batchSize;var n=this.gl;if(0!==i){if(i>s&&(i=s),!this.data){this.initBuffers();for(var r=0;r<this.properties.length;r++){var a=this.properties[r];n.vertexAttribPointer(a.attribute,a.size,n.FLOAT,!1,4*this.stride,4*a.offset)}}this.updateData(e,i),n.bufferSubData(n.ARRAY_BUFFER,0,this.data),n.drawElements(n.TRIANGLES,6*i,n.UNSIGNED_SHORT,0)}}initBuffers(){var t=this.gl,e=0;this.stride=0;for(var i=0;i<this.properties.length;i++){var s=this.properties[i];s.offset=e,e+=s.size,this.stride+=s.size}this.data=new Float32Array(this.size*this.stride*4),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,this.data,t.DYNAMIC_DRAW);for(var n=6*this.size,r=new Uint16Array(n),a=(i=0,0);i<n;i+=6,a+=4)r[i]=a,r[i+1]=a+1,r[i+2]=a+2,r[i+3]=a,r[i+4]=a+2,r[i+5]=a+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW)}updateData(t,e){this.stride;for(var i=0,s=this.data,n=this.renderer.frames,r=0;r<e;r++){var a=t[r],o=n[a.frame],h=o.width*a.scale,c=o.height*a.scale,l=a.x,u=a.y,d=a.rotation,m=o.uvs,f=a.alpha;s[i]=-h,s[++i]=-c,s[++i]=l,s[++i]=u,s[++i]=d,s[++i]=m[0],s[++i]=m[1],s[++i]=f,s[++i]=h,s[++i]=-c,s[++i]=l,s[++i]=u,s[++i]=d,s[++i]=m[2],s[++i]=m[1],s[++i]=f,s[++i]=h,s[++i]=c,s[++i]=l,s[++i]=u,s[++i]=d,s[++i]=m[2],s[++i]=m[3],s[++i]=f,s[++i]=-h,s[++i]=c,s[++i]=l,s[++i]=u,s[++i]=d,s[++i]=m[0],s[++i]=m[3],s[++i]=f,i++}}}class H{constructor(t,e){this.container=t,e=e||{},this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",t.appendChild(this.canvas);var i=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl",ctxOptions);this.gl=i,i.disable(i.DEPTH_TEST),i.disable(i.CULL_FACE),i.enable(i.BLEND),this.renderTarget=new j(i,this.width,this.height),this.currentRenderer=new W(i,this),this.resize(this.width,this.height)}render(t){t.renderWebGL(this)}resize(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e,this.gl.viewport(0,0,t,e)}}},1:function(t,e){t.exports="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aAlpha;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vAlpha;\n\nvoid main(void){\n  float cosine = cos(aRotation);\n  float sine = sin(aRotation);\n\n  vec3 v;\n  v.x = aVertexPosition.x * cosine - aVertexPosition.y * sine;\n  v.y = aVertexPosition.x * sine + aVertexPosition.y * cosine;\n  v.z = 1.0;\n\n  // Move\n  v.xy += aPositionCoord;\n\n  gl_Position = vec4(projectionMatrix * v, 1.0);\n\n  vTextureCoord = aTextureCoord;\n  vAlpha = aAlpha;\n}"},2:function(t,e){t.exports="precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying float vAlpha;\n\nuniform sampler2D uImage;\n\nvoid main(void){\n  vec4 color = texture2D(uImage, vTextureCoord) * vAlpha;\n  if (color.a == 0.0) discard;\n  gl_FragColor = color;\n}"},3:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return r}));var s=i(0);var n=function t(e){var i,n,r,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(t){a.img=new Image,a.img.onload=a.imgCallback,a.img.src="data:image/jpeg;base64,"+Object(s.k)(t)},(n="prepareImageData")in(i=this)?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r;var o=e.container||document.body;if(e.hasOwnProperty("url")&&Object(s.q)({url:e.url,container:o}).then(e.cb).catch((function(t){return console.error(t)})),e.hasOwnProperty("img")){this.imgCallback=e.img.cb,Object(s.p)({url:e.img.src,container:o,loadingMsg:e.img.msg}).then(this.prepareImageData),this.imgW=e.img.width,this.imgH=e.img.height,this.fps=e.fps;var h=this.imgW-e.img.offLeft-e.img.offRight,c=this.imgH-e.img.offTop-e.img.offBottom;this.percent={h:Object(s.n)(c,this.imgH),w:Object(s.n)(h,this.imgW),top:Object(s.n)(e.img.offTop,this.imgH),bottom:Object(s.n)(e.img.offBottom,this.imgH),left:Object(s.n)(e.img.offLeft,this.imgW),right:Object(s.n)(e.img.offRight,this.imgW)}}this.stage=Object(s.l)(o,{w:o.offsetWidth}),this.canvas=this.stage.canvas,this.ctx=this.stage.ctx},r=function(t){return new Promise((function(e,i){t.onloadedmetadata=function(){return e()},t.onerror=function(e){var s=document.createElement("div");s.innerHTML=t.innerHTML,t.parentNode.replaceChild(s,t),console.log(e),i(e)}}))}},33:function(t,e,i){"use strict";i.r(e);var s=i(0);function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var r=function(){function t(e,i,s,n,r,a,o){var h,c,l,u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l=function(){u.reset(),u.timeline(!0),u.notations(!0),u.videoData(!0),u.resizeData(),u.repaintTimeline(),u.updateNotations()},(c="updateRepaint")in(h=this)?Object.defineProperty(h,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):h[c]=l,this.images=e,this.t=i,this.n=s,this.labelBox=n,this.video=r,this.repaintTimeline=a,this.updateNotations=o}var e,i,r;return e=t,(i=[{key:"bindData",value:function(t,e){this.d=t,this.timelineBg=e}},{key:"reset",value:function(){this.bottomW=window.innerWidth,this.topH=document.getElementById("header").offsetHeight,this.timelinePercent=Object(s.n)(this.bottomW,this.images.totalW),this.bottomH=Object(s.t)(this.timelinePercent,this.images.height)+30|0,this.leftH=window.innerHeight-this.topH-this.bottomH,this.notationsPercent=Object(s.n)(this.leftH,this.images.height)}},{key:"timeline",value:function(t){this.d&&(t||this.reset(),this.timelineH=0|Object(s.t)(this.timelinePercent,this.images.height),this.t.canvas.width=this.timelineBg.canvas.width=this.bottomW,this.t.canvas.height=this.timelineBg.canvas.height=this.bottomH,this.t.stage.container.style.height="".concat(this.bottomH,"px"),this.bottomH>this.timelineH?this.t.offY=this.bottomH/2-this.timelineH/2:this.t.offY=0,this.t.offX=0|Object(s.t)(this.timelinePercent,this.d.initX),this.t.ctx.strokeStyle="red",this.images.timelineW=Object(s.t)(this.timelinePercent,1e3))}},{key:"notations",value:function(t){if(this.d){t||this.reset();var e=this.n.stage.container;this.leftW=e.offsetWidth,e.style.top="".concat(this.topH,"px"),e.style.height="".concat(this.leftH,"px"),this.n.resizeW=Object(s.t)(this.notationsPercent,this.images.totalW),this.n.canvas.height=this.leftH,this.n.canvas.width=this.leftW,this.n.offX=0|Object(s.t)(this.notationsPercent,this.d.initX),this.n.ctx.strokeStyle="red",this.labelBox.style.left="".concat(this.n.offX,"px"),this.images.notationsW=Object(s.t)(this.notationsPercent,1e3)}}},{key:"videoData",value:function(t){if(this.d){t||this.reset();var e=window.innerHeight-this.bottomH,i=this.d.endX-this.d.initX;this.video.style.maxHeight="".concat(e,"px"),this.video.style.marginTop="".concat(e/2-this.video.offsetHeight/2,"px"),this.videoTimelineW=this.video.duration/Object(s.t)(this.timelinePercent,i),this.videoNotationsW=this.video.duration/Object(s.t)(this.notationsPercent,i)}}},{key:"resizeData",value:function(){var t=this;this.d&&(this.d.sections.forEach((function(e,i){var n=e.x,r=i===t.d.sections.length-1?t.d.endX-n:t.d.sections[i+1].x-n;e.nX=0|Object(s.t)(t.notationsPercent,n),e.nW=0|Object(s.t)(t.notationsPercent,r),e.tX=0|Object(s.t)(t.timelinePercent,n),e.tW=0|Object(s.t)(t.timelinePercent,r)})),this.d.labels.forEach((function(e){e.nX=0|Object(s.t)(t.notationsPercent,e.x),e.nY=t.topH+Object(s.t)(t.notationsPercent,e.y)|0,e.nW=0|Object(s.t)(t.notationsPercent,e.w),e.nH=0|Object(s.t)(t.notationsPercent,e.h)})))}},{key:"all",value:function(){this.reset(),this.timeline(!0),this.notations(!0),this.videoData(!0),this.resizeData()}}])&&n(e.prototype,i),r&&n(e,r),t}(),a=i(3);function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var h,c,l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.paintTimelineFrame=e,this.total=16,this.loaded=0,this.totalW=15458,this.width=1e3,this.height=785,this.frames={},this.loadingMsg="Please be patient, loading large images",this.msg=document.createElement("p"),this.msg.className="loading-msg",this.msg.innerText=this.loadingMsg,this.loading=document.createElement("div"),this.loading.className="loading",this.loading.style.opacity=0,this.progress=document.createElement("progress"),this.progress.className="progress",this.progress.style.zIndex=0,this.progress.max=100,this.progress.value=0,this.loading.appendChild(this.progress),this.loading.appendChild(this.msg)}var e,i,s;return e=t,(i=[{key:"load",value:function(t){var e=this;return new Promise((function(i,s){for(var n=function(s){var n=new Image;n.dataset.key=s,n.onload=function(){var s=n.dataset.key,r=e.timelineW;e.loaded++;var a=e.loaded/e.total*100;e.progress.value=a,e.msg.innerText="".concat(0|a,"%").concat("\n"+e.loadingMsg),e.paintTimelineFrame(e.frames[s],s*r,t,r),e.loaded===e.total&&i()},n.src="/img/assets/notations/tango/tango".concat(s,".jpg"),e.frames[s]=n},r=0;r<e.total;r++)n(r)}))}}])&&o(e.prototype,i),s&&o(e,s),t}(),u=document.getElementById("bottom"),d=document.getElementById("left"),m=document.getElementById("label-box"),f=document.getElementById("pol"),g=document.getElementById("eng"),p=new a.a({container:u}),v=new a.a({container:d}),b=new l(_),x=document.getElementById("video"),y={},T=0,w=!1,E=0,z=0,P=0;d.appendChild(b.loading),Object(a.b)(x).then((function(){Object(s.q)("/data/notations/tango.json").then((function(t){A.bindData(t),y=t,T=t.sections.length,h=Object(s.l)(u,{h:p.canvas.height,zi:1}),A.timelineBg=h,A.all(),h.ctx.fillRect(0,0,A.bottomW,A.bottomH),b.loading.style.opacity=1,b.load(p.offY).then((function(){d.removeChild(b.loading),O(),x.controls=!0,d.onmousedown=function(t){E=t.clientX,w=!0},d.onmouseup=R,u.onmouseup=R,d.onmousemove=function(t){if(w){var e=E-t.clientX;x.currentTime+=A.videoNotationsW*e,E=t.clientX}else{for(var i=t.clientX,s=t.clientY,n=!1,r=0;r<y.labels.length;r++){var a=y.labels[r].nX-P,o=a+y.labels[r].nW,h=y.labels[r].nY,c=h+y.labels[r].nH;if(i>=a&&i<o&&s>=h&&s<c){m.className=y.labels[r].class,m.style.top=h-A.topH-16+"px",f.innerText=y.labels[r].label,g.innerText=y.labels[r].eng,n=!0,m.style.opacity=1;break}}n||(m.style.opacity=0)}},d.onmouseleave=function(){return w=!1},u.onmousedown=function(t){var e=t.clientX-z;x.currentTime+=A.videoTimelineW*e,w=!0},u.onmousemove=function(t){if(w){var e=t.clientX-z;x.currentTime+=A.videoTimelineW*e}}}))})).catch((function(t){return console.error(t)})),x.onplay=function(){return c=requestAnimationFrame(j)},x.onpause=function(){return window.cancelAnimationFrame(c)},x.onseeking=function(){return O()}}));var A=new r(b,p,v,m,x,(function(){var t=b.timelineW;h.ctx.fillRect(0,0,A.bottomW,A.bottomH);for(var e=0;e<b.total;e++)_(b.frames[e],e*t,p.offY,t)}),O);function R(){w=!1}function j(){O(),c=requestAnimationFrame(j)}function O(){for(var t,e,i=x.currentTime,s=0;s<T;s++)if(s<T-1){if(i>=y.sections[s].start&&i<y.sections[s+1].start){t=y.sections[s],e=y.sections[s+1];break}}else t=y.sections[s],e={start:x.duration,x:y.endX};var n=e.start-t.start,r=i-t.start,a=r*(t.nW/n),o=r*(t.tW/n);z=o+t.tX,P=a+(t.nX-v.offX),p.ctx.clearRect(0,0,A.bottomW,A.bottomH),p.ctx.beginPath(),p.ctx.moveTo(z,0),p.ctx.lineTo(z,A.bottomH),p.ctx.stroke(),function(t){var e=b.notationsW;v.ctx.clearRect(0,0,A.leftW,A.leftH);for(var i=0;i<b.total;i++){var s=i*e-t;if(!(s+e<=0)){if(s>A.leftW)break;S(b.frames[i],s,e)}}}(P),v.ctx.beginPath(),v.ctx.moveTo(v.offX,0),v.ctx.lineTo(v.offX,A.leftH),v.ctx.stroke()}function S(t,e,i){v.ctx.drawImage(t,0,0,b.width,b.height,e,0,i,A.leftH)}function _(t,e,i,s){h.ctx.drawImage(t,0,0,b.width,b.height,0|e,0|i,s,A.timelineH)}window.onresize=A.updateRepaint}});